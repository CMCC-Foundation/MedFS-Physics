#!/bin/sh
# --------------------------------------------------------------------------- #
# all_switches : Make a list of all switches hat are found in the program     #
#                (.ftn) files of WAVEWATCH III.                               #
#                                                                             #
# use         : all_switches                                                  #
#                                                                             #
#                                                      Hendrik L. Tolman      #
#                                                      May 2009               #
#                                                                             #
#    Copyright 2009 National Weather Service (NWS),                           #
#       National Oceanic and Atmospheric Administration.  All rights          #
#       reserved.  WAVEWATCH III is a trademark of the NWS.                   #
#       No unauthorized use without permission.                               #
#                                                                             #
# --------------------------------------------------------------------------- #
# 1. Preparations                                                             #
# --------------------------------------------------------------------------- #
# 1.a Internal variables

  ww3_env='.wwatch3.env'   # setup file

# 1.b ID header  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

  echo ' '
  echo 'Find all switches in WAVEWATCH III'
  echo '----------------------------------'

# 1.c Get env. data  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

  cd
  if test -f $ww3_env
  then
    set `grep WWATCH3_DIR $ww3_env` ; shift
    main_dir="$*"
  else
    echo "*** Set-up file $ww3_env not found ***"
    exit
  fi

  cd $main_dir/ftn

# --------------------------------------------------------------------------- #
# 2. Strip all switches from sources                                          #
# --------------------------------------------------------------------------- #

  all=`sed -n '/^!\//'p *.ftn | sed -n '/^!\/$/'!p | sed -n '/^!\/ /'!p | \
     sed 's/!\///g' | sed 's/\// /g' | awk '{ print $1 }' | sort -u | more`

  set $all

# --------------------------------------------------------------------------- #
# 3. Display in organized manner                                              #
# --------------------------------------------------------------------------- #

  last=
  line='   '

  while [ "$#" -gt '0' ]
  do
    next=$1 ; shift
    if [ -z "$last" ] ; then
      line="$line $next"
    else
      if [ "`echo $last | cut -c1-1`" != "`echo $next | cut -c1-1`" ] ; then
        echo "$line"
        line='   '
      fi
      line="$line $next"
    fi
    last=$next
  done

  echo "$line"

  echo ' '
  echo 'end of all_switches'

# End of all_switches ------------------------------------------------------- #
